{% trans_default_domain 'BreithbarbotCropperBundle' %}
{% block breithbarbot_cropper_bundle_cropper_type_widget %}
    {% set identifier = (form.children._identifier is defined and form.children._identifier.vars.value is not empty) ? '-'~form.children._identifier.vars.value : '' %}
    {% spaceless %}
        <div class="avatar-view" title="{{ 'croppingTool'|trans }}">
            <img class="img-responsive img-thumbnail" src="{% if (form.vars.value is not null) and (form.vars.value.path is defined) %}{{ asset(form.vars.value.path) }}{% else %}/placeholder/{{ form._width.vars.value~'x'~form._height.vars.value }}{% endif %}" alt="Image cropped">
        </div>
        <script>
            $(document).ready(function () {
                {% if form.vars.value is null %}
                    DummyImage.generate();
                {% endif %}
                // Initializing cropper modal
                $('.avatar-view').on('click', function (e) {
                    // Variable
                    $avatarModal = $('#avatar-modal{{ identifier }}');
                    // Closure
                    $elem = $(this);
                    // Set current image
                    $avatarModal.find('.avatar-wrapper').empty().html('<img src="' + $elem.find('img').attr('src') + '" />');
                    // Set additional data
                    {% for key, item in form.children %}
                        {% if key not in ['_width', '_height'] %}
                            {% for key, item in item.vars.attr %}
                                $avatarModal.find('.additional-data').append('<input type="hidden" name="{{ key }}" value="{{ item }}">');
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                    // Show / Hide remove button
                    {% if data %}
                        $avatarModal.find('.avatar-remove').show();
                    {% else %}
                        $avatarModal.find('.avatar-remove').hide();
                    {% endif %}
                    // Open the cropper modal
                    $avatarModal.modal('show');
                });
            });
        </script>
    {% endspaceless %}
{% endblock %}
